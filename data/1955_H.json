{
    "title": "H. The Most Reckless Defense",
    "timeLimit": {
        "value": 3.0,
        "unit": "seconds"
    },
    "memoryLimit": {
        "value": 256.0,
        "unit": "megabytes"
    },
    "statement": "<p>You are playing a very popular Tower Defense game called \"Runnerfield 2\". In this game, the player sets up defensive towers that attack enemies moving from a certain starting point to the player's base.</p><p>You are given a grid of size $$$n \\times m$$$, on which $$$k$$$ towers are already placed and a path is laid out through which enemies will move. The cell at the intersection of the $$$x$$$-th row and the $$$y$$$-th column is denoted as $$$(x, y)$$$.</p><p>Each second, a tower deals $$$p_i$$$ units of damage to all enemies within its range. For example, if an enemy is located at cell $$$(x, y)$$$ and a tower is at $$$(x_i, y_i)$$$ with a range of $$$r$$$, then the enemy will take damage of $$$p_i$$$ if $$$(x - x_i) ^ 2 + (y - y_i) ^ 2 \\le r ^ 2$$$.</p><p>Enemies move from cell $$$(1, 1)$$$ to cell $$$(n, m)$$$, visiting each cell of the path exactly once. An enemy instantly moves to an adjacent cell horizontally or vertically, but before doing so, it spends one second in the current cell. If its health becomes zero or less during this second, the enemy can no longer move. The player loses if an enemy reaches cell $$$(n, m)$$$ and can make one more move.</p><p>By default, all towers have a zero range, but the player can set a tower's range to an integer $$$r$$$ ($$$r &gt; 0$$$), in which case the health of all enemies will increase by $$$3^r$$$. However, each $$$r$$$ can only be used for <span class=\"tex-font-style-bf\">at most one</span> tower.</p><p>Suppose an enemy has a base health of $$$h$$$ units. If the tower ranges are $$$2$$$, $$$4$$$, and $$$5$$$, then the enemy's health at the start of the path will be $$$h + 3 ^ 2 + 3 ^ 4 + 3 ^ 5 = h + 9 + 81 + 243 = h + 333$$$. The choice of ranges is made once before the appearance of enemies and cannot be changed after the game starts.</p><p>Find the maximum amount of base health $$$h$$$ for which it is possible to set the ranges so that the player does not lose when an enemy with health $$$h$$$ passes through (without considering the additions for tower ranges).</p>",
    "inputSpecification": "<p>The first line contains an integer $$$t$$$ ($$$1 \\le t \\le 100$$$) \u2014 the number of test cases.</p><p>The first line of each test case contains three integers $$$n$$$, $$$m$$$, and $$$k$$$ ($$$2 \\le n, m \\le 50, 1 \\le k &lt; n \\cdot m$$$) \u2014 the dimensions of the field and the number of towers on it.</p><p>The next $$$n$$$ lines each contain $$$m$$$ characters \u2014 the description of each row of the field, where the character \".\" denotes an empty cell, and the character \"#\" denotes a path cell that the enemies will pass through.</p><p>Then follow $$$k$$$ lines \u2014 the description of the towers. Each line of description contains three integers $$$x_i$$$, $$$y_i$$$, and $$$p_i$$$ ($$$1 \\le x_i \\le n, 1 \\le y_i \\le m, 1 \\le p_i \\le 500$$$) \u2014 the coordinates of the tower and its attack parameter. All coordinates correspond to empty cells on the game field, and all pairs $$$(x_i, y_i)$$$ are pairwise distinct.</p><p>It is guaranteed that the sum of $$$n \\cdot m$$$ does not exceed $$$2500$$$ for all test cases.</p>",
    "outputSpecification": "<p>For each test case, output the maximum amount of base health $$$h$$$ on a separate line, for which it is possible to set the ranges so that the player does not lose when an enemy with health $$$h$$$ passes through (without considering the additions for tower ranges).</p><p>If it is impossible to choose ranges even for an enemy with $$$1$$$ unit of base health, output \"0\".</p>",
    "samples": [
        {
            "input": "\n<div class=\"test-example-line test-example-line-even test-example-line-0\">6</div><div class=\"test-example-line test-example-line-odd test-example-line-1\">2 2 1</div><div class=\"test-example-line test-example-line-odd test-example-line-1\">#.</div><div class=\"test-example-line test-example-line-odd test-example-line-1\">##</div><div class=\"test-example-line test-example-line-odd test-example-line-1\">1 2 1</div><div class=\"test-example-line test-example-line-even test-example-line-2\">2 2 1</div><div class=\"test-example-line test-example-line-even test-example-line-2\">#.</div><div class=\"test-example-line test-example-line-even test-example-line-2\">##</div><div class=\"test-example-line test-example-line-even test-example-line-2\">1 2 2</div><div class=\"test-example-line test-example-line-odd test-example-line-3\">2 2 1</div><div class=\"test-example-line test-example-line-odd test-example-line-3\">#.</div><div class=\"test-example-line test-example-line-odd test-example-line-3\">##</div><div class=\"test-example-line test-example-line-odd test-example-line-3\">1 2 500</div><div class=\"test-example-line test-example-line-even test-example-line-4\">3 3 2</div><div class=\"test-example-line test-example-line-even test-example-line-4\">#..</div><div class=\"test-example-line test-example-line-even test-example-line-4\">##.</div><div class=\"test-example-line test-example-line-even test-example-line-4\">.##</div><div class=\"test-example-line test-example-line-even test-example-line-4\">1 2 4</div><div class=\"test-example-line test-example-line-even test-example-line-4\">3 1 3</div><div class=\"test-example-line test-example-line-odd test-example-line-5\">3 5 2</div><div class=\"test-example-line test-example-line-odd test-example-line-5\">#.###</div><div class=\"test-example-line test-example-line-odd test-example-line-5\">#.#.#</div><div class=\"test-example-line test-example-line-odd test-example-line-5\">###.#</div><div class=\"test-example-line test-example-line-odd test-example-line-5\">2 2 2</div><div class=\"test-example-line test-example-line-odd test-example-line-5\">2 4 2</div><div class=\"test-example-line test-example-line-even test-example-line-6\">5 5 4</div><div class=\"test-example-line test-example-line-even test-example-line-6\">#....</div><div class=\"test-example-line test-example-line-even test-example-line-6\">#....</div><div class=\"test-example-line test-example-line-even test-example-line-6\">#....</div><div class=\"test-example-line test-example-line-even test-example-line-6\">#....</div><div class=\"test-example-line test-example-line-even test-example-line-6\">#####</div><div class=\"test-example-line test-example-line-even test-example-line-6\">3 2 142</div><div class=\"test-example-line test-example-line-even test-example-line-6\">4 5 9</div><div class=\"test-example-line test-example-line-even test-example-line-6\">2 5 79</div><div class=\"test-example-line test-example-line-even test-example-line-6\">1 3 50</div>",
            "output": "\n0\n1\n1491\n11\n8\n1797\n"
        }
    ],
    "note": "<p>In the first example, there is no point in increasing the tower range, as it will not be able to deal enough damage to the monster even with $$$1$$$ unit of health.</p><p>In the second example, the tower has a range of $$$1$$$, and it deals damage to the monster in cells $$$(1, 1)$$$ and $$$(2, 2)$$$.</p><p>In the third example, the tower has a range of $$$2$$$, and it deals damage to the monster in all path cells. If the enemy's base health is $$$1491$$$, then after the addition for the tower range, its health will be $$$1491 + 3 ^ 2 = 1500$$$, which exactly equals the damage the tower will deal to it in three seconds.</p><p>In the fourth example, the tower at $$$(1, 2)$$$ has a range of $$$1$$$, and the tower at $$$(3, 1)$$$ has a range of $$$2$$$.</p>",
    "contestId": 1955,
    "index": "H",
    "name": "The Most Reckless Defense",
    "type": "PROGRAMMING",
    "tags": [
        "bitmasks",
        "brute force",
        "constructive algorithms",
        "dp",
        "flows",
        "graph matchings",
        "shortest paths"
    ],
    "solvedCount": 1094
}