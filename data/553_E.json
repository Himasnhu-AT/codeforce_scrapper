{
    "title": "E. Kyoya and Train",
    "timeLimit": {
        "value": 8.0,
        "unit": "seconds"
    },
    "memoryLimit": {
        "value": 512.0,
        "unit": "megabytes"
    },
    "statement": "<p>Kyoya Ootori wants to take the train to get to school. There are <span class=\"tex-span\"><i>n</i></span> train stations and <span class=\"tex-span\"><i>m</i></span> one-way train lines going between various stations. Kyoya is currently at train station <span class=\"tex-span\">1</span>, and the school is at station <span class=\"tex-span\"><i>n</i></span>. To take a train, he must pay for a ticket, and the train also takes a certain amount of time. However, the trains are not perfect and take random amounts of time to arrive at their destination. If Kyoya arrives at school strictly after <span class=\"tex-span\"><i>t</i></span> time units, he will have to pay a fine of <span class=\"tex-span\"><i>x</i></span>.</p><p>Each train line is described by a ticket price, and a probability distribution on the time the train takes. More formally, train line <span class=\"tex-span\"><i>i</i></span> has ticket cost <span class=\"tex-span\"><i>c</i><sub class=\"lower-index\"><i>i</i></sub></span>, and a probability distribution <span class=\"tex-span\"><i>p</i><sub class=\"lower-index\"><i>i</i>,\u2009<i>k</i></sub></span> which denotes the probability that this train will take <span class=\"tex-span\"><i>k</i></span> time units for all <span class=\"tex-span\">1\u2009\u2264\u2009<i>k</i>\u2009\u2264\u2009<i>t</i></span>. Amounts of time that each of the trains used by Kyouya takes are mutually independent random values (moreover, if Kyoya travels along the same train more than once, it is possible for the train to take different amounts of time and those amounts are also independent one from another). </p><p>Kyoya wants to get to school by spending the least amount of money in expectation (for the ticket price plus possible fine for being late). Of course, Kyoya has an optimal plan for how to get to school, and every time he arrives at a train station, he may recalculate his plan based on how much time he has remaining. What is the expected cost that Kyoya will pay to get to school if he moves optimally?</p>",
    "inputSpecification": "<p>The first line of input contains four integers <span class=\"tex-span\"><i>n</i>,\u2009<i>m</i>,\u2009<i>t</i>,\u2009<i>x</i></span> (<span class=\"tex-span\">2\u2009\u2009\u2264\u2009\u2009<i>n</i>\u2009\u2009\u2264\u200950</span>, <span class=\"tex-span\">1\u2009\u2264\u2009<i>m</i>\u2009\u2264\u2009100</span>, <span class=\"tex-span\">1\u2009\u2264\u2009<i>t</i>\u2009\u2264\u200920\u2009000</span>, <span class=\"tex-span\">0\u2009\u2264\u2009<i>x</i>\u2009\u2264\u200910<sup class=\"upper-index\">6</sup></span>).</p><p>The next <span class=\"tex-span\">2<i>m</i></span> lines contain the description of the trains. </p><p>The <span class=\"tex-span\">2<i>i</i></span>-th line will have <span class=\"tex-span\">3</span> integers <span class=\"tex-span\"><i>a</i><sub class=\"lower-index\"><i>i</i></sub>,\u2009<i>b</i><sub class=\"lower-index\"><i>i</i></sub>,\u2009<i>c</i><sub class=\"lower-index\"><i>i</i></sub></span>, representing a one way train from station <span class=\"tex-span\"><i>a</i><sub class=\"lower-index\"><i>i</i></sub></span> to <span class=\"tex-span\"><i>b</i><sub class=\"lower-index\"><i>i</i></sub></span> with ticket cost <span class=\"tex-span\"><i>c</i><sub class=\"lower-index\"><i>i</i></sub></span> (<span class=\"tex-span\">1\u2009\u2264\u2009<i>a</i><sub class=\"lower-index\"><i>i</i></sub>,\u2009<i>b</i><sub class=\"lower-index\"><i>i</i></sub>\u2009\u2264\u2009<i>n</i></span>, <span class=\"tex-span\"><i>a</i><sub class=\"lower-index\"><i>i</i></sub>\u2009\u2260\u2009<i>b</i><sub class=\"lower-index\"><i>i</i></sub></span>, <span class=\"tex-span\">0\u2009\u2264\u2009<i>c</i><sub class=\"lower-index\"><i>i</i></sub>\u2009\u2264\u200910<sup class=\"upper-index\">6</sup></span>). There will always be at least one path from any station to the school. </p><p>The <span class=\"tex-span\">(2<i>i</i>\u2009+\u20091)</span>-th line will contain <span class=\"tex-span\"><i>t</i></span> integers, <span class=\"tex-span\"><i>p</i><sub class=\"lower-index\"><i>i</i>,\u20091</sub>,\u2009<i>p</i><sub class=\"lower-index\"><i>i</i>,\u20092</sub>,\u2009...,\u2009<i>p</i><sub class=\"lower-index\"><i>i</i>,\u2009<i>t</i></sub></span> where <span class=\"tex-span\"><i>p</i><sub class=\"lower-index\"><i>i</i>,\u2009<i>k</i></sub>\u2009/\u2009100000</span> is the probability that this train will take <span class=\"tex-span\"><i>k</i></span> units of time to traverse (<span class=\"tex-span\">0\u2009\u2264\u2009<i>p</i><sub class=\"lower-index\"><i>i</i>,\u2009<i>k</i></sub>\u2009\u2264\u2009100\u2009000</span> for <span class=\"tex-span\">1\u2009\u2264\u2009<i>k</i>\u2009\u2264\u2009<i>t</i></span>, <img align=\"middle\" class=\"tex-formula\" src=\"https://espresso.codeforces.com/1dd6644a681804a6c6570ab0c07a69e19b83516c.png\" style=\"max-width: 100.0%;max-height: 100.0%;\"/>). </p><p>It is guaranteed that there is no more than one train between each pair of platforms in each of the directions.</p>",
    "outputSpecification": "<p>Print a single real number that is equal to an optimal expected cost of getting to school. The answer will be considered correct if its relative or absolute error doesn't exceed <span class=\"tex-span\">10<sup class=\"upper-index\">\u2009-\u20096</sup></span>.</p>",
    "samples": [
        {
            "input": "4 4 5 1<br/>1 2 0<br/>50000 0 50000 0 0<br/>2 3 0<br/>10000 0 0 0 90000<br/>3 4 0<br/>100000 0 0 0 0<br/>2 4 0<br/>0 0 0 50000 50000<br/>",
            "output": "0.7000000000<br/>"
        },
        {
            "input": "4 4 5 1<br/>1 2 100<br/>50000 0 50000 0 0<br/>2 3 100<br/>10000 0 0 0 90000<br/>3 4 100<br/>100000 0 0 0 0<br/>2 4 100<br/>0 0 0 50000 50000<br/>",
            "output": "200.7500000000<br/>"
        }
    ],
    "note": "<p>The optimal strategy in the first case is as follows:</p><p>First, travel along first train line. With probability <span class=\"tex-span\">1\u2009/\u20092</span> Kyoya will take <span class=\"tex-span\">1</span> time unit. Otherwise, Kyoya will take <span class=\"tex-span\">3</span> time units.</p><p>If the train takes <span class=\"tex-span\">1</span> time unit, travel along the 4th train line. Kyoya will make it to school in time with probability <span class=\"tex-span\">1\u2009/\u20092</span>. Otherwise, if the train takes 3 time units, travel along the 2nd train line. Kyoya will make it to school in time with probability <span class=\"tex-span\">1\u2009/\u200910</span>.</p><p>Since the cost of all train lines are zero, we can just look at the probability that Kyoya will incur the penalty. The probability that Kyoya will have to pay the penalty is <span class=\"tex-span\">1\u2009/\u20092\u2009\u00d7\u20091\u2009/\u20092\u2009+\u20091\u2009/\u20092\u2009\u00d7\u20099\u2009/\u200910\u2009=\u20097\u2009/\u200910</span>. We can show that no other strategy is strictly better.</p><p>The optimal strategy in the second case is to travel along <span class=\"tex-span\">1\u2009\u2192\u20092\u2009\u2192\u20094</span> no matter what. Kyoya will incur the penalty with probability <span class=\"tex-span\">3\u2009/\u20094</span>, and the cost of the trains is <span class=\"tex-span\">200</span>, thus the expected cost is <span class=\"tex-span\">200.75</span>.</p>",
    "contestId": 553,
    "index": "E",
    "name": "Kyoya and Train",
    "type": "PROGRAMMING",
    "tags": [
        "dp",
        "fft",
        "graphs",
        "math",
        "probabilities"
    ],
    "solvedCount": 539
}