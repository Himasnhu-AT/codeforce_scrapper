{
    "title": "D. LuoTianyi and the Function",
    "timeLimit": {
        "value": 7.0,
        "unit": "seconds"
    },
    "memoryLimit": {
        "value": 1024.0,
        "unit": "megabytes"
    },
    "statement": "<p>LuoTianyi gives you an array $$$a$$$ of $$$n$$$ integers and the index begins from $$$1$$$.</p><p>Define $$$g(i,j)$$$ as follows:</p><ul> <li> $$$g(i,j)$$$ is the largest integer $$$x$$$ that satisfies $$$\\{a_p:i\\le p\\le j\\}\\subseteq\\{a_q:x\\le q\\le j\\}$$$ while $$$i \\le j$$$; </li><li> and $$$g(i,j)=0$$$ while $$$i&gt;j$$$. </li></ul><p>There are $$$q$$$ queries. For each query you are given four integers $$$l,r,x,y$$$, you need to calculate $$$\\sum\\limits_{i=l}^{r}\\sum\\limits_{j=x}^{y}g(i,j)$$$.</p>",
    "inputSpecification": "<p>The first line contains two integers $$$n$$$ and $$$q$$$ ($$$1\\le n,q\\le 10^6$$$) \u2014 the length of the array $$$a$$$ and the number of queries.</p><p>The second line contains $$$n$$$ integers $$$a_1,a_2,\\ldots,a_n$$$ ($$$1\\le a_i\\le n$$$) \u2014 the elements of the array $$$a$$$.</p><p>Next $$$q$$$ lines describe a query. The $$$i$$$-th line contains four integers $$$l,r,x,y$$$ ($$$1\\le l\\le r\\le n, 1\\le x\\le y\\le n$$$) \u2014 the integers in the $$$i$$$-th query.</p>",
    "outputSpecification": "<p>Print $$$q$$$ lines where $$$i$$$-th line contains one integer \u2014 the answer for the $$$i$$$-th query.</p>",
    "samples": [
        {
            "input": "\n6 4\n1 2 2 1 3 4\n1 1 4 5\n2 3 3 3\n3 6 1 2\n6 6 6 6\n",
            "output": "\n6\n6\n0\n6\n"
        },
        {
            "input": "\n10 5\n10 2 8 10 9 8 2 1 1 8\n1 1 10 10\n2 2 3 3\n6 6 6 6\n1 1 4 5\n4 8 4 8\n",
            "output": "\n4\n2\n6\n4\n80\n"
        }
    ],
    "note": "<p>In the first example:</p><p>In the first query, the answer is $$$g(1,4)+g(1,5)=3+3=6$$$.</p><p>$$$x=1,2,3$$$ can satisfies $$$\\{a_p:1\\le p\\le 4\\}\\subseteq\\{a_q:x\\le q\\le 4\\}$$$, $$$3$$$ is the largest integer so $$$g(1,4)=3$$$.</p><p>In the second query, the answer is $$$g(2,3)+g(3,3)=3+3=6$$$.</p><p>In the third query, the answer is $$$0$$$, because all $$$i &gt; j$$$ and $$$g(i,j)=0$$$.</p><p>In the fourth query, the answer is $$$g(6,6)=6$$$.</p><p>In the second example:</p><p>In the second query, the answer is $$$g(2,3)=2$$$.</p><p>In the fourth query, the answer is $$$g(1,4)+g(1,5)=2+2=4$$$.</p>",
    "contestId": 1824,
    "index": "D",
    "name": "LuoTianyi and the Function",
    "type": "PROGRAMMING",
    "tags": [
        "data structures"
    ],
    "solvedCount": 465
}