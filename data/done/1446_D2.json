{
    "title": "D2. Frequency Problem (Hard Version)",
    "timeLimit": {
        "value": 2.0,
        "unit": "seconds"
    },
    "memoryLimit": {
        "value": 256.0,
        "unit": "megabytes"
    },
    "statement": "<p><span class=\"tex-font-style-bf\">This is the hard version of the problem. The difference between the versions is in the constraints on the array elements. You can make hacks only if all versions of the problem are solved.</span></p><p>You are given an array $$$[a_1, a_2, \\dots, a_n]$$$. </p><p>Your goal is to find the length of the longest subarray of this array such that the most frequent value in it is <span class=\"tex-font-style-bf\">not</span> unique. In other words, you are looking for a subarray such that if the most frequent value occurs $$$f$$$ times in this subarray, then at least $$$2$$$ different values should occur exactly $$$f$$$ times.</p><p>An array $$$c$$$ is a subarray of an array $$$d$$$ if $$$c$$$ can be obtained from $$$d$$$ by deletion of several (possibly, zero or all) elements from the beginning and several (possibly, zero or all) elements from the end.</p>",
    "inputSpecification": "<p>The first line contains a single integer $$$n$$$ ($$$1 \\le n \\le 200\\,000$$$)\u00a0\u2014 the length of the array.</p><p>The second line contains $$$n$$$ integers $$$a_1, a_2, \\ldots, a_n$$$ ($$$1 \\le a_i \\le n$$$)\u00a0\u2014 elements of the array.</p>",
    "outputSpecification": "<p>You should output exactly one integer \u00a0\u2014 the length of the longest subarray of the array whose most frequent value is not unique. If there is no such subarray, output $$$0$$$.</p>",
    "samples": [
        {
            "input": "\n7\n1 1 2 2 3 3 3\n",
            "output": "\n6\n"
        },
        {
            "input": "\n10\n1 1 1 5 4 1 3 1 2 2\n",
            "output": "\n7\n"
        },
        {
            "input": "\n1\n1\n",
            "output": "\n0\n"
        }
    ],
    "note": "<p>In the first sample, the subarray $$$[1, 1, 2, 2, 3, 3]$$$ is good, but $$$[1, 1, 2, 2, 3, 3, 3]$$$ isn't: in the latter there are $$$3$$$ occurrences of number $$$3$$$, and no other element appears $$$3$$$ times.</p>",
    "contestId": 1446,
    "index": "D2",
    "name": "Frequency Problem (Hard Version)",
    "type": "PROGRAMMING",
    "tags": [
        "data structures",
        "greedy",
        "two pointers"
    ],
    "solvedCount": 1239
}