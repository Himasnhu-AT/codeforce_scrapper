{
    "title": "E2. Salyg1n and Array (hard version)",
    "timeLimit": {
        "value": 1.0,
        "unit": "second"
    },
    "memoryLimit": {
        "value": 256.0,
        "unit": "megabytes"
    },
    "statement": "<p><span class=\"tex-font-style-bf\">This is the hard version of the problem. The only difference between the versions is the limit on the number of queries. In this version, you can make no more than 57 queries. You can make hacks only if both versions of the problem are solved.</span></p><p><span class=\"tex-font-style-bf\">This is an interactive problem!</span></p><p>salyg1n has given you a positive integer $$$k$$$ and wants to play a game with you. He has chosen an array of $$$n$$$ integers $$$a_1, a_2, \\ldots, a_n$$$ ($$$1 \\leq a_i \\leq 10^9$$$). You must print $$$a_1 \\oplus a_2 \\oplus \\ldots \\oplus a_n$$$, where $$$\\oplus$$$ denotes the <a href=\"https://en.wikipedia.org/wiki/Bitwise_operation#XOR\">bitwise XOR</a> operation. You can make queries of the following type:</p><ul> <li> $$$?$$$ $$$i$$$: in response to this query, you will receive $$$a_i \\oplus a_{i + 1} \\oplus \\ldots \\oplus a_{i + k - 1}$$$. Also, after this query, the subarray $$$a_i, a_{i + 1}, \\ldots, a_{i + k - 1}$$$ will be reversed, i.e., the chosen array $$$a$$$ will become: $$$a_1, a_2, \\ldots a_{i - 1}, a_{i + k - 1}, a_{i + k - 2}, \\ldots, a_{i + 1}, a_i, a_{i + k}, \\ldots, a_n$$$. </li></ul><p>You can make no more than $$$57$$$ queries to answer the problem.</p>",
    "inputSpecification": "<p>The first line contains a single integer $$$t$$$ ($$$1 \\leq t \\leq 1000$$$) \u2013 the number of test cases.</p>",
    "outputSpecification": null,
    "samples": [
        {
            "input": "\n2\n4 2\n\n6\n\n4\n\n6 6\n\n4",
            "output": "\n? 1\n\n? 3\n\n! 2\n\n? 1\n\n! 4"
        }
    ],
    "note": "<p>In the first test case, the jury has chosen the array $$$a$$$ $$$=$$$ $$$[4, 2, 5, 1]$$$</p><p>In the second test case, the jury has chosen the array $$$a$$$ $$$=$$$ $$$[5, 7, 1, 3, 3, 7]$$$</p>",
    "contestId": 1867,
    "index": "E2",
    "name": "Salyg1n and Array (hard version)",
    "type": "PROGRAMMING",
    "tags": [
        "constructive algorithms",
        "interactive"
    ],
    "solvedCount": 3032
}