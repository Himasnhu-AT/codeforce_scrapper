{
    "title": "F2. Tree Cutting (Hard Version)",
    "timeLimit": {
        "value": 2.0,
        "unit": "seconds"
    },
    "memoryLimit": {
        "value": 256.0,
        "unit": "megabytes"
    },
    "statement": "<p>You are given an undirected tree of $$$n$$$ vertices. </p><p>Some vertices are colored one of the $$$k$$$ colors, some are uncolored. It is guaranteed that the tree contains at least one vertex of each of the $$$k$$$ colors. There might be no uncolored vertices.</p><p>You choose a subset of <span class=\"tex-font-style-bf\">exactly $$$k - 1$$$ edges</span> and remove it from the tree. Tree falls apart into $$$k$$$ connected components. Let's call this subset of edges <span class=\"tex-font-style-it\">nice</span> if none of the resulting components contain vertices of different colors.</p><p>How many <span class=\"tex-font-style-it\">nice</span> subsets of edges are there in the given tree? Two subsets are considered different if there is some edge that is present in one subset and absent in the other.</p><p>The answer may be large, so print it modulo $$$998244353$$$.</p>",
    "inputSpecification": "<p>The first line contains two integers $$$n$$$ and $$$k$$$ ($$$2 \\le n \\le 3 \\cdot 10^5$$$, $$$2 \\le k \\le n$$$) \u2014 the number of vertices in the tree and the number of colors, respectively.</p><p>The second line contains $$$n$$$ integers $$$a_1, a_2, \\dots, a_n$$$ ($$$0 \\le a_i \\le k$$$) \u2014 the colors of the vertices. $$$a_i = 0$$$ means that vertex $$$i$$$ is uncolored, any other value means the vertex $$$i$$$ is colored that color.</p><p>The $$$i$$$-th of the next $$$n - 1$$$ lines contains two integers $$$v_i$$$ and $$$u_i$$$ ($$$1 \\le v_i, u_i \\le n$$$, $$$v_i \\ne u_i$$$) \u2014 the edges of the tree. It is guaranteed that the given edges form a tree. It is guaranteed that the tree contains at least one vertex of each of the $$$k$$$ colors. There might be no uncolored vertices.</p>",
    "outputSpecification": "<p>Print a single integer \u2014 the number of <span class=\"tex-font-style-it\">nice</span> subsets of edges in the given tree. Two subsets are considered different if there is some edge that is present in one subset and absent in the other.</p><p>The answer may be large, so print it modulo $$$998244353$$$.</p>",
    "samples": [
        {
            "input": "\n5 2\n2 0 0 1 2\n1 2\n2 3\n2 4\n2 5\n",
            "output": "\n1\n"
        },
        {
            "input": "\n7 3\n0 1 0 2 2 3 0\n1 3\n1 4\n1 5\n2 7\n3 6\n4 7\n",
            "output": "\n4\n"
        }
    ],
    "note": "<p>Here is the tree from the first example:</p><center> <img class=\"tex-graphics\" src=\"https://espresso.codeforces.com/d1424e4ad356c095259ae83de573a5b843b945b0.png\" style=\"max-width: 100.0%;max-height: 100.0%;\"/> </center><p>The only <span class=\"tex-font-style-it\">nice</span> subset is edge $$$(2, 4)$$$. Removing it makes the tree fall apart into components $$$\\{4\\}$$$ and $$$\\{1, 2, 3, 5\\}$$$. The first component only includes a vertex of color $$$1$$$ and the second component includes only vertices of color $$$2$$$ and uncolored vertices.</p><p>Here is the tree from the second example:</p><center> <img class=\"tex-graphics\" src=\"https://espresso.codeforces.com/b667741c1945463eaf06dd104f4a5be8c63d52e3.png\" style=\"max-width: 100.0%;max-height: 100.0%;\"/> </center><p>The <span class=\"tex-font-style-it\">nice</span> subsets are $$$\\{(1, 3), (4, 7)\\}$$$, $$$\\{(1, 3), (7, 2)\\}$$$, $$$\\{(3, 6), (4, 7)\\}$$$ and $$$\\{(3, 6), (7, 2)\\}$$$.</p>",
    "contestId": 1118,
    "index": "F2",
    "name": "Tree Cutting (Hard Version)",
    "type": "PROGRAMMING",
    "tags": [
        "combinatorics",
        "dfs and similar",
        "dp",
        "trees"
    ],
    "solvedCount": 523
}