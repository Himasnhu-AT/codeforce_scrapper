{
    "title": "01. Labyrinth-1",
    "timeLimit": {
        "value": 8.0,
        "unit": "seconds"
    },
    "memoryLimit": {
        "value": 512.0,
        "unit": "megabytes"
    },
    "statement": "<p>You have a robot in a two-dimensional labyrinth which consists of <span class=\"tex-span\"><i>N</i>\u2009\u00d7\u2009<i>M</i></span> cells. Some pairs of cells adjacent by side are separated by a wall or a door. The labyrinth itself is separated from the outside with walls around it. Some labyrinth cells are the exits. In order to leave the labyrinth the robot should reach any exit. There are keys in some cells. Any key can open any door but after the door is opened the key stays in the lock. Thus every key can be used only once. There are no labyrinth cells that contain both a key and an exit. Also there can not be both a wall and a door between the pair of adjacent cells.</p><p>Your need to write a program in <span class=\"tex-span\"><i>abc</i></span> language (see the language description below) that will lead the robot to one of the exits. Lets numerate the labyrinth rows from <span class=\"tex-span\">0</span> to <span class=\"tex-span\"><i>N</i>\u2009-\u20091</span> top to bottom and the columns \u2013 from <span class=\"tex-span\">0</span> to <span class=\"tex-span\"><i>M</i>\u2009-\u20091</span> left to right.</p><p>In <span class=\"tex-span\"><i>abc</i></span> language the following primary commands are available:</p><ul> <li> <span class=\"tex-font-style-tt\">move-DIR</span> \u2013 move to the adjacent cell in the <img align=\"middle\" class=\"tex-formula\" src=\"https://espresso.codeforces.com/b141dfef648cb0749068acd4c95c8d2a280477f8.png\" style=\"max-width: 100.0%;max-height: 100.0%;\"/> direction. <span class=\"tex-span\"><i>down</i></span> increases the number of the row by 1, <span class=\"tex-span\"><i>right</i></span> increases the number of the column by 1. In case there\u2019s a wall or a closed door in this direction, nothing\u2019s happening. </li><li> <span class=\"tex-font-style-tt\">open-DIR</span> \u2013 open the door between the current cell and the adjacent one in <span class=\"tex-span\"><i>DIR</i></span> direction. In case there isn\u2019t any door in this direction or it\u2019s already been opened or the robot doesn\u2019t have a key, nothing\u2019s happening.</li><li> <span class=\"tex-font-style-tt\">take</span> \u2013 take the key in the current cell. In case there isn\u2019t any key or the robot has already picked it up, nothing\u2019s happening. The robot is able to carry any number of keys.</li><li> <span class=\"tex-font-style-tt\">terminate</span> \u2013 terminate the program. This command is not obligatory to use. In case it\u2019s absent the command is added at the end of the program automatically. </li></ul><p>Also, there are the following control commands in <span class=\"tex-span\"><i>abc</i></span> language: </p><ul> <li> <span class=\"tex-font-style-tt\">for-N OPS end</span> \u2013 repeat the sequence of the <span class=\"tex-span\"><i>OPS</i></span> commands <span class=\"tex-span\"><i>N</i></span> times, <span class=\"tex-span\">0\u2009&lt;\u2009<i>N</i>\u2009\u2264\u2009100000</span>. Each loop counter check counts as a command fulfilled by the robot. </li><li> <span class=\"tex-font-style-tt\">if-ok  OPS1  else  OPS2  endif</span> \u2013 carries out the sequence of the <span class=\"tex-span\"><i>OPS</i>1</span> commands, if the previous command of moving, taking the key or opening the door was successful, otherwise the sequence of the <span class=\"tex-span\"><i>OPS</i>2</span> commands is being carried out. Should there be no previous command run, the sequence <span class=\"tex-span\"><i>OPS</i>1</span> will be carried out. If-ok check counts as a command fulfilled by the robot. </li><li> <span class=\"tex-font-style-tt\">break</span> \u2013 stops the current <span class=\"tex-span\"><i>for</i></span> loop. </li><li> <span class=\"tex-font-style-tt\">continue</span> \u2013 finishes the current <span class=\"tex-span\"><i>for</i></span> loop iterations. </li></ul><p>Note that the control and the primary commands can be fit into each other arbitrarily.</p><p>The robot will fulfill your commands sequentially until it exits the labyrinth, or it runs out of the commands, or the <span class=\"tex-span\"><i>terminate</i></span> command is run, or the quantity of the fulfilled commands exceeds the bound number <span class=\"tex-span\">5\u00b710<sup class=\"upper-index\">6</sup></span>.</p><p>In <span class=\"tex-span\"><i>abc</i></span> language each command is a separate word and should be separated from other commands with at least one space symbol.</p><p>You should write a program that prints the sequence of commands leading the robot out of the labyrinth. Of course, as you are a good programmer, you should optimize these sequence.</p><p>The number of the non-space symbols in the sequence should not exceed <span class=\"tex-span\">10<sup class=\"upper-index\">7</sup></span>. If you succeed in finding the way out of the labyrinth <span class=\"tex-span\"><i>i</i></span> you\u2019ll be granted the number of points equal to: </p><center class=\"tex-equation\"><img align=\"middle\" class=\"tex-formula\" src=\"https://espresso.codeforces.com/1b1e4b878ba291db65b49befbe8e47d1f804fdb9.png\" style=\"max-width: 100.0%;max-height: 100.0%;\"/></center> where: <ul> <li> <span class=\"tex-span\"><i>W</i><sub class=\"lower-index\"><i>i</i></sub></span> \u2013 labyrinth\u2019s weight, some fixed constant. </li><li> <span class=\"tex-span\"><i>G</i><sub class=\"lower-index\"><i>i</i></sub></span> \u2013 number of robots moves. </li><li> <span class=\"tex-span\"><i>O</i><sub class=\"lower-index\"><i>i</i></sub></span> \u2013 number of fulfilled commands. Note that this number includes commands like <span class=\"tex-span\"><i>take</i></span> executed in the cells with no key, as well as opening commands applied to the already opened doors. </li><li> <span class=\"tex-span\"><i>L</i><sub class=\"lower-index\"><i>i</i></sub></span> \u2013 sequence length in symbols, excluding space symbols and line breaks. </li><li> <span class=\"tex-span\"><i>Q</i>\u2009=\u200910\u00b7<i>N</i>\u00b7<i>M</i></span>. </li></ul><p>In case your sequence doesn\u2019t lead the robot to the exit you\u2019ll be granted <span class=\"tex-span\">0</span> points. Your programs result will be the sum of all <span class=\"tex-span\"><i>S</i><sub class=\"lower-index\"><i>i</i></sub></span>. You should maximize this total sum.</p><p>All labyrinths will be known and available to you. You can download the archive with labyrinths by any of the given links, password to extract files is <span class=\"tex-font-style-tt\">aimtechiscool</span>:</p><ol> <li> <a href=\"https://drive.google.com/file/d/1dkIBfW_Gy6c3FJtXjMXZPMsGKRyn3pzp\">https://drive.google.com/file/d/1dkIBfW_Gy6c3FJtXjMXZPMsGKRyn3pzp</a> </li><li> <a href=\"https://www.dropbox.com/s/77jrplnjgmviiwt/aimmaze.zip?dl=0\">https://www.dropbox.com/s/77jrplnjgmviiwt/aimmaze.zip?dl=0</a> </li><li> <a href=\"https://yadi.sk/d/JNXDLeH63RzaCi\">https://yadi.sk/d/JNXDLeH63RzaCi</a> </li></ol><p>In order to make local testing of your programs more convenient, the program calculating your results (checker) and the labyrinth visualizer will be available. This program is written in <span class=\"tex-span\"><i>python</i>3</span> programming language, that\u2019s why you\u2019re going to need <span class=\"tex-span\"><i>python</i>3</span> interpreter, as well as <span class=\"tex-span\"><i>pillow</i></span> library, which you can install with the following command <span class=\"tex-font-style-tt\">pip3 install pillow</span>. <span class=\"tex-span\"><i>pip</i>3</span> is a utility program for <span class=\"tex-span\"><i>python</i>3</span> package (library) installation. It will be installed automatically with the <span class=\"tex-span\"><i>python</i>3</span> interpreter.</p><p>Example command to run checker and visualizer: <span class=\"tex-font-style-tt\">python3 aimmaze.py maze.in robot.abc --image maze.png</span>. The checker can be run separately of visualization: <span class=\"tex-font-style-tt\">python3 aimmaze.py maze.in robot.abc</span>. Flag <span class=\"tex-font-style-tt\">--output-log</span> will let you see the information of robots each step: <span class=\"tex-font-style-tt\">python3 aimmaze.py maze.in robot.abc --output-log</span>. Note <span class=\"tex-span\"><i>python</i>3</span> can be installed as <span class=\"tex-span\"><i>python</i></span> on your computer.</p><p>To adjust image settings, you can edit constants at the beginning of the program <span class=\"tex-span\"><i>aimmaze</i>.<i>py</i></span>.</p>",
    "inputSpecification": "<p>The first line contains integers <span class=\"tex-span\"><i>i</i>,\u2009\u00a0<i>W</i>,\u2009\u00a0<i>N</i>,\u2009\u00a0<i>M</i>,\u2009\u00a0<i>x</i><sub class=\"lower-index\">0</sub>,\u2009\u00a0<i>y</i><sub class=\"lower-index\">0</sub>,\u2009\u00a0<i>C</i>,\u2009\u00a0<i>D</i>,\u2009\u00a0<i>K</i>,\u2009\u00a0<i>E</i></span>. </p><ul> <li> <span class=\"tex-span\">1\u2009\u2264\u2009<i>i</i>\u2009\u2264\u200914</span> \u2013 labyrinth\u2019s number, which is needed for a checking program. </li><li> <span class=\"tex-span\">1\u2009\u2264\u2009<i>W</i>\u2009\u2264\u200910<sup class=\"upper-index\">18</sup></span> \u2013 labyrinth\u2019s weight, which is needed for a checking program. </li><li> <span class=\"tex-span\">2\u2009\u2264\u2009<i>N</i>,\u2009<i>M</i>\u2009\u2264\u20091000</span> \u2013 labyrinth\u2019s height and width. </li><li> <span class=\"tex-span\">0\u2009\u2264\u2009<i>x</i><sub class=\"lower-index\">0</sub>\u2009\u2264\u2009<i>N</i>\u2009-\u20091,\u2009\u00a00\u2009\u2264\u2009<i>y</i><sub class=\"lower-index\">0</sub>\u2009\u2264\u2009<i>M</i>\u2009-\u20091</span> \u2013 robot\u2019s starting position <span class=\"tex-span\">(<i>x</i><sub class=\"lower-index\">0</sub>,\u2009<i>y</i><sub class=\"lower-index\">0</sub>)</span>. </li><li> <span class=\"tex-span\">0\u2009\u2264\u2009<i>C</i>\u2009\u2264\u20092\u00b7<i>NM</i></span> \u2013 number of walls. </li><li> <span class=\"tex-span\">0\u2009\u2264\u2009<i>D</i>\u2009\u2264\u200910<sup class=\"upper-index\">5</sup></span> \u2013 number of doors. </li><li> <span class=\"tex-span\">0\u2009\u2264\u2009<i>K</i>\u2009\u2264\u200910<sup class=\"upper-index\">5</sup></span> \u2013 number of keys. </li><li> <span class=\"tex-span\">1\u2009\u2264\u2009<i>E</i>\u2009\u2264\u20091000</span> \u2013 number of exits. </li></ul><p>The <span class=\"tex-span\"><i>x</i></span> coordinate corresponds to the row number, <span class=\"tex-span\"><i>y</i></span> \u2013 to the column number. <span class=\"tex-span\">(0,\u20090)</span> cell is located on the left-up corner, so that <span class=\"tex-span\"><i>down</i></span> direction increases the <span class=\"tex-span\"><i>x</i></span> coordinate, while <span class=\"tex-span\"><i>right</i></span> direction increases the <span class=\"tex-span\"><i>y</i></span> coordinate.</p><p>Each of the next <span class=\"tex-span\"><i>C</i></span> lines contains <span class=\"tex-span\">4</span> integers each <span class=\"tex-span\"><i>x</i><sub class=\"lower-index\">1</sub>,\u2009<i>y</i><sub class=\"lower-index\">1</sub>,\u2009<i>x</i><sub class=\"lower-index\">2</sub>,\u2009<i>y</i><sub class=\"lower-index\">2</sub></span> \u2013 the coordinates of cells with a wall between them in a zero based indexing. It is guaranteed that <span class=\"tex-span\">|<i>x</i><sub class=\"lower-index\">1</sub>\u2009-\u2009<i>x</i><sub class=\"lower-index\">2</sub>|\u2009+\u2009|<i>y</i><sub class=\"lower-index\">1</sub>\u2009-\u2009<i>y</i><sub class=\"lower-index\">2</sub>|\u2009=\u20091,\u2009\u00a00\u2009\u2264\u2009<i>x</i><sub class=\"lower-index\">1</sub>,\u2009<i>x</i><sub class=\"lower-index\">2</sub>\u2009\u2264\u2009<i>N</i>\u2009-\u20091,\u2009\u00a00\u2009\u2264\u2009<i>y</i><sub class=\"lower-index\">1</sub>,\u2009<i>y</i><sub class=\"lower-index\">2</sub>\u2009\u2264\u2009<i>M</i>\u2009-\u20091</span>. Also there are always walls around the labyrinth\u2019s borders, which are not given in the labyrinths description.</p><p>Each of the next <span class=\"tex-span\"><i>D</i></span> lines contains door description in the same format as walls description. It is guaranteed that doors and walls don\u2019t overlap.</p><p>Each of the next <span class=\"tex-span\"><i>K</i></span> rows contains a pair of integer which are the key coordinates in a zero based indexing.</p><p>Each of the next <span class=\"tex-span\"><i>E</i></span> rows contains a pair of integer which are the exit coordinates in a zero based indexing.</p><p>It is guaranteed that the robots starting position as well as keys and exits are located in pairwise different cells.</p>",
    "outputSpecification": "<p>Print a program in <span class=\"tex-span\"><i>abc</i></span> language which passes the given labyrinth. Commands have to be separated by at least one space symbol. You can use arbitrary formatting for the program.</p>",
    "samples": [
        {
            "input": "1 1 30 30 1 1 1 1 1 1<br/>1 1 1 2<br/>2 2 2 3<br/>1 4<br/>9 0<br/>",
            "output": "for-1111<br/>  take<br/>  open-up<br/>  open-left<br/>  open-right<br/>  open-down<br/>  move-left<br/>  if-ok<br/>    for-11<br/>      move-left<br/>  take<br/>  open-up<br/>  open-left<br/>  open-right<br/>  open-down<br/>    end<br/>  else<br/>    move-right<br/>    if-ok<br/>      for-11<br/>        move-right<br/>  take<br/>  open-up<br/>  open-left<br/>  open-right<br/>  open-down<br/>      end<br/>    else endif<br/>  endif<br/><br/>  move-up<br/>  if-ok<br/>    for-11<br/>      move-up<br/>  take<br/>  open-up<br/>  open-left<br/>  open-right<br/>  open-down<br/>    end<br/>  else<br/>    move-down<br/>    if-ok<br/>      for-11<br/>        move-down<br/>  take<br/>  open-up<br/>  open-left<br/>  open-right<br/>  open-down<br/>      end<br/>    else endif<br/>  endif<br/><br/>end"
        }
    ],
    "note": null,
    "contestId": 921,
    "index": "01",
    "name": "Labyrinth-1",
    "type": "PROGRAMMING",
    "tags": [],
    "solvedCount": 0
}